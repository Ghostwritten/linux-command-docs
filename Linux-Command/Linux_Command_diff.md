#  Linux Command  diff 文件比较


![在这里插入图片描述](https://img-blog.csdnimg.cn/3d4a795045ee40c98ca47c90dbd2f7a9.gif#pic_center)


## 1. 简介
diff命令是比较两个版本不同的文件以找到改动的地方。
diff是`svn、cvs、git`等版本控制工具不可或缺的一部分。
语法：

```bash
$ diff <变动前的文件> <变动后的文件>
```
## 2. 如何读懂
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200507230417936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpeGloYWhhbGVsZWhlaGU=,size_16,color_FFFFFF,t_70)
## 3. 三种格式

由于历史原因，diff有三种格式：
 - 正常格式（normal diff）
- 上下文格式（context diff）
- 合并格式（unified diff）

第一个文件叫做f1，内容是每行一个a，一共7行。

```bash
a
a
a
a
a
a
a
```

第二个文件叫做f2，修改f1而成，第4行变成b，其他不变。

```bash
a
a
a
b
a
a
a
```
### 3.1 正常格式的diff
最早的Unix（即AT&T版本的Unix），使用的就是这种格式的diff
现在对f1和f2进行比较：

```bash
$ diff f1 f2

4c4   #它分成三个部分：前面的"4"，表示f1的第4行有变化；"c"表示变动的模式是内容改变（change），其他模式还有"增加"（a，代表addition）和"删除"（d，代表deletion）；后面的"4"，表示变动后变成f2的第4行。
< a   #前面的小于号，表示要从f1当中去除该行（也就是第4行），后面的"a"表示该行的内容。
---   #第三行用来分割f1和f2。
> b   #前面的大于号表示f2增加了该行，后面的"b"表示该行的内容。
```
### 3.2 上下文格式的diff

上个世纪80年代初，加州大学伯克利分校推出BSD版本的Unix时，觉得diff的显示结果太简单，最好加入上下文，便于了解发生的变动。因此，推出了上下文格式的diff。

它的使用方法是加入c参数（代表context）。

```bash
    $ diff -c f1 f2

#第一部分的两行，显示两个文件的基本情况：文件名和时间信息
　　*** f1 2012-08-29 16:45:41.000000000 +0800  #"***"表示变动前的文件
　　--- f2 2012-08-29 16:45:51.000000000 +0800  #"---"表示变动后的文件
　　*************** #第二部分是15个星号，将文件的基本情况与变动内容分割开
　　*** 1,7 ****  #第三部分显示变动前的文件，从第1行开始连续7行
　　 a
　　 a
　　 a     #文件内容的每一行最前面，还有一个标记位:
　　!a     #1. 如果是感叹号（!），表示该行有改动；
　　 a     #2. 如果为空，表示该行无变化；
　　 a     #3. 如果是减号（-），表示该行被删除；
　　 a     #4. 如果是加号（+），表示该行为新增。
　　--- 1,7 ----  #总共显示7行
　　 a
　　 a
　　 a
　　!b
　　 a
　　 a
　　 a
```

### 3.3 合并格式的diff

如果两个文件相似度很高，那么上下文格式的diff，将显示大量重复的内容，很浪费空间。1990年，GNU diff率先推出了"合并格式"的diff，将f1和f2的上下文合并在一起显示。

它的使用方法是加入u参数（代表unified）。

```bash
     $ diff -u f1 f2
     
　　--- f1 2012-08-29 16:45:41.000000000 +0800  #"---"表示变动前的文件
　　+++ f2 2012-08-29 16:45:51.000000000 +0800  #"+++"表示变动后的文件
　　@@ -1,7 +1,7 @@  #两个@作为起首和结束,减号表示第一个文件即f1，加号表示第二个文件即f2
　　 a
　　 a
　　 a #每一行最前面的标志位，空表示无变动
　　-a #减号表示第一个文件删除的行
　　+b #加号表示第二个文件新增的行。
　　 a
　　 a
　　 a
```
除了有变动的那些行以外，也是上下文各显示3行。它将两个文件的上下文，合并显示在一起，所以叫做"合并格式"。

### 3.4 git格式的diff

版本管理系统git，使用的是合并格式diff的变体。

```bash
　$ git diff

　　diff --git a/f1 b/f1   #a版本的f1（即变动前）和b版本的f1（即变动后）
　　index 6f8a38c..449b072 100644 #表示两个版本的git哈希值（index区域的6f8a38c对象，与工作目录区域的449b072对象进行比较），最后的六位数字是对象的模式（普通文件，644权限）。
　　--- a/f1  #"---"表示变动前的版本
　　+++ b/f1  #"+++"表示变动后的版本
　　@@ -1,7 +1,7 @@  #后面的行都与官方的合并格式diff相同
　　 a
　　 a
　　 a
　　-a
　　+b
　　 a
　　 a
　　 a
```

更多阅读：

 - [读懂diff](http://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html)
